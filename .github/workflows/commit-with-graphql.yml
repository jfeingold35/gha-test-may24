name: commit-with-graphql
on:
  workflow_dispatch:

jobs:
  do-the-thing:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - uses: actions/checkout@v4
      - run: git fetch --all
      - run: git checkout d/graphql-test
      - run: export GH_TOKEN=${{secrets.GITHUB_TOKEN}}
      - run: |
          gh api graphql -F eho=`git rev-parse HEAD~` -f query='
          mutation ($eho: GitObjectID!) {
              createCommitOnBranch(input: {
                  branch: {
                      repositoryNameWithOwner: "jfeingold35/gha-test-may24",
                      branchName: "d/graphql-test"
                  },
                  message: {
                      headline: "this is a headline"
                  },
                  fileChanges: {
                      additions: [
                          {
                              path: "README.md",
                              contents: "YXNkZmFzZGZhc2Rm"
                          }
                      ]
                  },
                  expectedHeadOid: $eho
              }) {
                  commit {
                      id
                  }
              }
          }
          '